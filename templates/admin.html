<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --g-blue: #1a73e8; --g-red: #ea4335; --g-green: #1e8e3e; --g-gray: #5f6368;
            --bg: #f8f9fa; --card: #ffffff; --text: #202124; --border: #dadce0; 
        }
        
        body { background: var(--bg); font-family: 'Google Sans', sans-serif; margin: 0; color: var(--text); -webkit-font-smoothing: antialiased; }

        /* Header Navigation */
        .nav-bar { background: #fff; padding: 12px 24px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .logo { font-weight: 700; color: var(--g-blue); font-size: 18px; letter-spacing: -0.5px; }
        .status-pill { font-size: 11px; color: var(--g-green); background: #e6f4ea; padding: 4px 12px; border-radius: 12px; font-weight: 700; display: flex; align-items: center; gap: 6px; }

        /* Content Grid */
        .container { max-width: 1300px; margin: 0 auto; padding: 24px; box-sizing: border-box; }
        .bento-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 24px; }
        @media (max-width: 480px) { .bento-grid { grid-template-columns: 1fr; gap: 16px; } .container { padding: 12px; } }

        /* Material Cards */
        .card { background: var(--card); border-radius: 12px; padding: 24px; border: 1px solid var(--border); transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        .card:hover { box-shadow: 0 4px 12px rgba(60,64,67,0.15); border-color: transparent; }
        
        h3 { margin: 0 0 18px 0; color: var(--g-blue); font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; display: flex; align-items: center; gap: 8px; }

        /* Forms */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        input, textarea, select { width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px; font-family: inherit; font-size: 14px; box-sizing: border-box; transition: all 0.2s; }
        input:focus { border-color: var(--g-blue); box-shadow: 0 0 0 2px rgba(26,115,232,0.1); outline: none; }
        textarea { resize: none; min-height: 80px; }
        label { font-size: 12px; color: var(--g-gray); margin-bottom: 4px; display: block; font-weight: 500; }

        /* Buttons */
        .action-group { display: flex; gap: 8px; margin-top: 4px; }
        .btn { border: none; padding: 10px 20px; border-radius: 20px; font-weight: 500; cursor: pointer; font-size: 14px; transition: background 0.2s; }
        .btn-primary { background: var(--g-blue); color: #fff; flex: 2; }
        .btn-primary:hover { background: #1765cc; }
        .btn-outline { background: #f1f3f4; color: var(--g-gray); flex: 1; display: none; }
        .btn-outline:hover { background: #e8eaed; }

        /* List Items */
        .preview-list { margin-top: 20px; border-top: 1px solid #f1f3f4; padding-top: 12px; max-height: 220px; overflow-y: auto; }
        .list-item { background: #fff; padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #f1f3f4; font-size: 13px; }
        .list-item:hover { background: #f8f9fa; }
        .item-text { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70%; }
        .item-ctrl { display: flex; gap: 4px; }
        .ctrl-btn { border: none; background: none; padding: 6px; cursor: pointer; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .ctrl-btn:hover { background: rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="nav-bar">
    <div class="logo">AATHISUDHAN <span style="font-weight:400; color:var(--g-gray)">/ Admin</span></div>
    <div class="status-pill">‚óè SYSTEM LIVE</div>
</div>

<div class="container">
    <div class="bento-grid">

        <div class="card" id="card-profile">
            <h3>Profile Details</h3>
            <div><label>Full Name</label><input type="text" id="p-name" placeholder="Full Name" value="{{data.get('profile', {}).get('name', '')}}"></div>
            <div><label>Profession</label><input type="text" id="p-prof" placeholder="Current Profession" value="{{data.get('profile', {}).get('profession', '')}}"></div>
            <div><label>Bio</label><textarea id="p-desc" placeholder="Bio">{{data.get('profile', {}).get('description', '')}}</textarea></div>
            <div class="form-row">
                <div><label>Date of Birth</label><input type="date" id="p-dob" value="{{data.get('profile', {}).get('dob', '')}}"></div>
                <div><label>Phone Number</label><input type="tel" id="p-phone" placeholder="Phone" value="{{data.get('profile', {}).get('phone', '')}}"></div>
            </div>
            <div><label>Email</label><input type="email" id="p-email" placeholder="Email Address" value="{{data.get('profile', {}).get('email', '')}}"></div>
            <div class="form-row">
                <div><label>City</label><input type="text" id="p-city" placeholder="City" value="{{data.get('profile', {}).get('city', '')}}"></div>
                <div><label>State</label><input type="text" id="p-state" placeholder="State" value="{{data.get('profile', {}).get('state', '')}}"></div>
            </div>
            <div><label>Country</label><input type="text" id="p-country" placeholder="Country" value="{{data.get('profile', {}).get('country', '')}}"></div>
            <button class="btn btn-primary" onclick="pushData('profile', {name:'p-name', profession:'p-prof', description:'p-desc', dob:'p-dob', phone:'p-phone', email:'p-email', city:'p-city', state:'p-state', country:'p-country'})">Save Profile</button>
        </div>

        <div class="card" id="card-socials">
            <h3>üìä Social Platforms</h3>
            <label>LinkedIn Link</label><input type="text" id="s-li" placeholder="https://..." value="{{data.get('socials', {}).get('linkedin_link', '')}}">
            <label>GitHub Link</label><input type="text" id="s-gh" placeholder="https://..." value="{{data.get('socials', {}).get('github_link', '')}}">
            <label>LeetCode Link</label><input type="text" id="s-lc" placeholder="https://..." value="{{data.get('socials', {}).get('leetcode_link', '')}}">
            <label>HackerRank Link</label><input type="text" id="s-hr" placeholder="https://..." value="{{data.get('socials', {}).get('hackerrank_link', '')}}">
            <div class="action-group">
                <button class="btn btn-primary" style="flex: none; width: auto; padding: 10px 30px;" onclick="pushData('socials', {linkedin_link:'s-li', github_link:'s-gh', leetcode_link:'s-lc', hackerrank_link:'s-hr'})">Update Links</button>
            </div>
        </div>

        <div class="card" id="card-skills">
            <h3>Technical Skills</h3>
            <input type="text" id="sk-name" placeholder="Skill (e.g. React.js)">
            <select id="sk-level">
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Advanced">Advanced</option>
                <option value="Expert">Expert</option>
            </select>
            <div class="action-group">
                <button class="btn btn-primary" id="sk-btn" onclick="pushData('skills', {name:'sk-name', level:'sk-level'})">Add Skill</button>
                <button class="btn btn-outline" id="sk-cancel" onclick="cancelEdit('skills')">Cancel</button>
            </div>
            <div class="preview-list">
                {% for id, item in data.get('skills', {}).items() %}
                <div class="list-item">
                    <span class="item-text">{{item.name}} ‚Äî <small style="color:var(--g-gray)">{{item.level}}</small></span>
                    <div class="item-ctrl">
                        <button class="ctrl-btn" style="color:var(--g-blue)" onclick="startEdit('skills','{{id}}')">‚úé</button>
                        <button class="ctrl-btn" style="color:var(--g-red)" onclick="deleteData('skills','{{id}}')">√ó</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card" id="card-education">
            <h3>Education</h3>
            <input type="text" id="edu-school" placeholder="School/University Name">
            <input type="text" id="edu-title" placeholder="Degree (e.g. B.Tech AI & DS)">
            <input type="text" id="edu-year" placeholder="Year / Duration">
            <div class="action-group">
                <button class="btn btn-primary" id="edu-btn" onclick="pushData('education', {school:'edu-school', title:'edu-title', year:'edu-year'})">Add Education</button>
                <button class="btn btn-outline" id="edu-cancel" onclick="cancelEdit('education')">Cancel</button>
            </div>
            <div class="preview-list">
                {% for id, item in data.get('education', {}).items() %}
                <div class="list-item">
                    <span class="item-text">{{item.title}}</span>
                    <div class="item-ctrl">
                        <button class="ctrl-btn" style="color:var(--g-blue)" onclick="startEdit('education','{{id}}')">‚úé</button>
                        <button class="ctrl-btn" style="color:var(--g-red)" onclick="deleteData('education','{{id}}')">√ó</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card" id="card-projects">
            <h3>Projects</h3>
            <input type="text" id="pj-title" placeholder="Project Title">
            <input type="text" id="pj-dom" placeholder="Domain (e.g. Machine Learning)">
            <input type="text" id="pj-link" placeholder="Live/GitHub URL">
            
            <label style="font-size: 11px; color: var(--g-gray); margin-bottom: 8px;">DESCRIPTION POINTS (MAX 3)</label>
            <input type="text" id="pj-p1" style="border-left: 3px solid var(--g-green)" placeholder="Point 1: Key feature or tech used">
            <input type="text" id="pj-p2" style="border-left: 3px solid var(--g-green)" placeholder="Point 2: Development detail">
            <input type="text" id="pj-p3" style="border-left: 3px solid var(--g-green)" placeholder="Point 3: Impact or Result">
        
            <div class="action-group">
                <button class="btn btn-primary" onclick="pushData('projects', {title:'pj-title', domain:'pj-dom', link:'pj-link', p1:'pj-p1', p2:'pj-p2', p3:'pj-p3'})">Save Project</button>
                <button class="btn btn-outline" onclick="cancelEdit('projects')">Cancel</button>
            </div>
        
            <div class="preview-list">
                {% for id, item in data.get('projects', {}).items() %}
                <div class="list-item">
                    <span class="item-text"><b>{{item.title}}</b></span>
                    <div class="item-ctrl">
                        <button class="ctrl-btn" style="color:var(--g-blue)" onclick="startEdit('projects','{{id}}')">‚úé</button>
                        <button class="ctrl-btn" style="color:var(--g-red)" onclick="deleteData('projects','{{id}}')">√ó</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card" id="card-certifications">
            <h3>Certifications</h3>
            <input type="text" id="c-title" placeholder="Certification Full Title">
            <input type="text" id="c-short" placeholder="Short Identifier (e.g. OCI-GenAI)">
            <input type="text" id="c-iss" placeholder="Issuing Organization">
            <input type="text" id="c-dom" placeholder="Domain">
            <input type="text" id="c-link" placeholder="Credential URL">
            <div class="action-group">
                <button class="btn btn-primary" id="c-btn" onclick="pushData('certifications', {title:'c-title', short_title:'c-short', issuer:'c-iss', domain:'c-dom', link:'c-link'})">Add Cert</button>
                <button class="btn btn-outline" id="c-cancel" onclick="cancelEdit('certifications')">Cancel</button>
            </div>
            <div class="preview-list">
                {% for id, item in data.get('certifications', {}).items() %}
                <div class="list-item">
                    <span class="item-text">{{item.short_title or item.title}}</span>
                    <div class="item-ctrl">
                        <button class="ctrl-btn" style="color:var(--g-blue)" onclick="startEdit('certifications','{{id}}')">‚úé</button>
                        <button class="ctrl-btn" style="color:var(--g-red)" onclick="deleteData('certifications','{{id}}')">√ó</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card" id="card-internships">
            <h3>Internships</h3>
            <input type="text" id="ex-role" placeholder="Your Role">
            <input type="text" id="ex-comp" placeholder="Company Name">
            <input type="text" id="ex-dur" placeholder="Duration (e.g. Jan 2024 - Present)">
            <input type="text" id="ex-dom" placeholder="Domain (e.g. Artificial Intelligence)">
            <input type="text" id="ex-link" placeholder="Certificate / Company Link">
            <div class="action-group">
                <button class="btn btn-primary" id="ex-btn" onclick="pushData('internships', {role:'ex-role', company:'ex-comp', duration:'ex-dur', domain:'ex-dom', link:'ex-link'})">Add Experience</button>
                <button class="btn btn-outline" id="ex-cancel" onclick="cancelEdit('internships')">Cancel</button>
            </div>
            <div class="preview-list">
                {% for id, item in data.get('internships', {}).items() %}
                <div class="list-item">
                    <span class="item-text">{{item.role}} @ {{item.company}}</span>
                    <div class="item-ctrl">
                        <button class="ctrl-btn" style="color:var(--g-blue)" onclick="startEdit('internships','{{id}}')">‚úé</button>
                        <button class="ctrl-btn" style="color:var(--g-red)" onclick="deleteData('internships','{{id}}')">√ó</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>

<script>
    window.serverData = {{ data | tojson }};
    let currentEdit = {category: null, id: null};

    async function pushData(category, fieldIds) {
        const payload = {};
        for (let key in fieldIds) {
            payload[key] = document.getElementById(fieldIds[key]).value;
        }

        let method = 'POST';
        let url = `/api/${category}`;
        if (currentEdit.category === category && currentEdit.id) {
            method = 'PUT';
            url = `/api/${category}/${currentEdit.id}`;
        }

        const response = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (response.ok) location.reload();
        else alert('Error updating data. Please try again.');
    }

    async function deleteData(cat, id) {
        if (!confirm('Delete this permanently?')) return;
        const response = await fetch(`/api/${cat}/${id}`, { method: 'DELETE' });
        if (response.ok) location.reload();
    }

    function startEdit(cat, id) {
        const item = window.serverData[cat][id];
        currentEdit = {category: cat, id: id};
        
        const card = document.getElementById(`card-${cat}`);
        const saveBtn = card.querySelector('.btn-primary');
        const cancelBtn = card.querySelector('.btn-outline');
        
        saveBtn.innerText = 'Update Entry';
        cancelBtn.style.display = 'block';

        if (cat === 'skills') {
            document.getElementById('sk-name').value = item.name || '';
            document.getElementById('sk-level').value = item.level || 'Intermediate';
        } else if (cat === 'education') {
            document.getElementById('edu-school').value = item.school || '';
            document.getElementById('edu-title').value = item.title || '';
            document.getElementById('edu-year').value = item.year || '';
        } else if (cat === 'projects') {
            document.getElementById('pj-title').value = item.title || '';
            document.getElementById('pj-dom').value = item.domain || '';
            document.getElementById('pj-link').value = item.link || '';
            document.getElementById('pj-p1').value = item.p1 || '';
            document.getElementById('pj-p2').value = item.p2 || '';
            document.getElementById('pj-p3').value = item.p3 || '';
        } else if (cat === 'certifications') {
            document.getElementById('c-title').value = item.title || '';
            document.getElementById('c-short').value = item.short_title || '';
            document.getElementById('c-iss').value = item.issuer || '';
            document.getElementById('c-dom').value = item.domain || '';
            document.getElementById('c-link').value = item.link || '';
        } else if (cat === 'internships') {
            document.getElementById('ex-role').value = item.role || '';
            document.getElementById('ex-comp').value = item.company || '';
            document.getElementById('ex-dur').value = item.duration || '';
            document.getElementById('ex-dom').value = item.domain || '';
            document.getElementById('ex-link').value = item.link || '';
        }
    }

    function cancelEdit(cat) {
        currentEdit = {category: null, id: null};
        const card = document.getElementById(`card-${cat}`);
        card.querySelector('.btn-primary').innerText = 'Add New Item';
        card.querySelector('.btn-outline').style.display = 'none';
        
        const fields = card.querySelectorAll('input, textarea');
        fields.forEach(f => f.value = '');
    }
</script>

</body>
</html>
